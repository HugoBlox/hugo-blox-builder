{{/*
  Smart Slides Single Layout
  Landing page for slide decks.
  Presentation output is rendered via the present output format.
*/}}

{{ define "main" }}

{{ $present_format := .OutputFormats.Get "present" }}
{{ $back_to_slides_label := i18n "back_to_slides" | default "Back to Slides" }}
{{ $featured_label := i18n "featured" | default "Featured" }}
{{ $slides_label := i18n "slides" | default "Slides" }}
{{ $abstract_label := i18n "callout_abstract" | default "Abstract" }}
{{ $topics_label := i18n "topics" | default "Topics" }}
{{ $related_resources_label := i18n "related_resources" | default "Related Resources" }}
{{ $present_fullscreen_label := i18n "present_fullscreen" | default "Present (fullscreen)" }}
{{ $copy_link_label := i18n "copy_link" | default "Copy Link" }}
{{ $copy_citation_label := i18n "copy_citation" | default "Copy citation" }}
{{ $copied_label := i18n "btn_copied" | default "Copied" }}
{{ $export_pdf_label := i18n "export_pdf_print" | default "Export PDF (print)" }}
{{ $print_hint := i18n "slides_print_hint" | default "Opens in print mode - use browser Print > Save as PDF" }}
{{ $how_to_cite_label := i18n "how_to_cite" | default "How to cite" }}
{{ $citation_label := i18n "citation" | default "Citation" }}
{{ $doi_label := i18n "btn_doi" | default "DOI" }}
{{ $bibtex_label := i18n "bibtex" | default "BibTeX" }}
{{ $download_cite_bib_label := i18n "download_cite_bib" | default "Download cite.bib" }}
{{ $lecture_label := i18n "lecture" | default "Lecture" }}

{{/* LANDING PAGE CONTENT */}}
<div id="deck-landing">
  
  {{/* Get slide metadata */}}
  {{ $authors := .Params.authors | default (slice) }}
  {{ $venue := .Params.venue }}
  {{ $event := .Params.event }}
  {{ $course := .Params.course }}
  {{ $lecture := .Params.lecture_number }}
  {{ $tags := .Params.tags | default (slice) }}
  {{ $topics := .Params.topics | default $tags }}
  {{ $description := .Params.abstract | default .Params.summary | default .Description }}
  {{ $citation := .Params.citation }}

  {{ $authorNames := slice }}
  {{ $authorList := slice }}
  {{ with $authors }}
    {{ if reflect.IsSlice . }}
      {{ $authorList = . }}
    {{ else }}
      {{ $authorList = slice . }}
    {{ end }}
  {{ end }}
  {{ range $authorList }}
    {{ $profile := partial "functions/get_author_profile" . }}
    {{ $authorName := . }}
    {{ if $profile.has_data }}
      {{ $authorName = $profile.title }}
    {{ end }}
    {{ $authorNames = $authorNames | append $authorName }}
  {{ end }}
  
  {{/* Build links using HugoBlox standard structure */}}
  {{ $builtLinks := partial "functions/build_links.html" (dict "page" . "is_list" false) }}
  
  {{/* Filter links by type for Related Resources section */}}
  {{ $resourceLinks := slice }}
  {{ $citationLinks := slice }}
  {{ range $builtLinks }}
    {{ if in (slice "pdf" "preprint" "code" "video" "dataset" "demo" "site") .type }}
      {{ $resourceLinks = $resourceLinks | append . }}
    {{ else if in (slice "doi" "bibtex") .type }}
      {{ $citationLinks = $citationLinks | append . }}
    {{ end }}
  {{ end }}

  {{ $citation_copy := "" }}
  {{ if $citation }}
    {{ $citation_copy = $citation }}
  {{ else }}
    {{ range $citationLinks }}
      {{ if and (eq $citation_copy "") (eq .type "doi") }}
        {{ $citation_copy = .url }}
      {{ else if and (eq $citation_copy "") (eq .type "bibtex") }}
        {{ $citation_copy = .url }}
      {{ end }}
    {{ end }}
  {{ end }}
  {{ $has_citation_copy := ne $citation_copy "" }}

  {{/* Calculate slide count */}}
  {{ $content := .RawContent }}
  {{ $slideCount := 1 }}
  {{ $separators := findRE "(?m)^---$" $content }}
  {{ if $separators }}
    {{ $slideCount = add (len $separators) 1 }}
    {{ if hasPrefix $content "---" }}
      {{ $slideCount = sub $slideCount 1 }}
    {{ end }}
  {{ end }}

  <div class="container mx-auto px-4 sm:px-6 max-w-5xl py-12" x-data="{ copied: false, showCitation: false, copyText: {{ $copy_link_label | jsonify }}, citationCopied: false, citationCopyText: {{ $copy_citation_label | jsonify }}, citationValue: {{ $citation_copy | jsonify }} }">
    
    {{/* Back to library link */}}
    <a href="{{ "/slides/" | relURL }}" class="inline-flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-400 hover:text-primary-600 dark:hover:text-primary-400 mb-6 transition-colors">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      {{ $back_to_slides_label }}
    </a>

    {{/* Main content card */}}
    <div class="bg-white dark:bg-zinc-900 rounded-2xl shadow-lg ring-1 ring-zinc-900/5 dark:ring-white/10 overflow-hidden mb-8">
      
      {{/* Hero section with gradient */}}
      <div class="relative px-8 py-12 bg-gradient-to-br from-primary-600 to-primary-800 dark:from-primary-700 dark:to-primary-900 text-white">
        {{/* Featured badge */}}
        {{ if or .Params.featured .Params.pinned }}
        <div class="absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-semibold bg-white/20 backdrop-blur-sm flex items-center gap-1.5">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
          </svg>
          {{ $featured_label }}
        </div>
        {{ end }}

        <h1 class="text-3xl md:text-4xl font-bold mb-4">{{ .Title }}</h1>
        
        {{/* Meta info */}}
        <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-white/80">
          {{ if gt (len $authorNames) 0 }}
          <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
            {{ delimit $authorNames ", " }}
          </div>
          {{ end }}
          
          {{ with $venue }}
          <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            {{ . }}
          </div>
          {{ end }}

          {{ with $event }}
          <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/>
            </svg>
            {{ . }}
          </div>
          {{ end }}

          {{ if $course }}
          <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
            </svg>
            {{ $course }}{{ with $lecture }} - {{ $lecture_label }} {{ . }}{{ end }}
          </div>
          {{ end }}
          
          <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            {{ .Date | time.Format "January 2006" }}
          </div>

          <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            {{ $slideCount }} {{ $slides_label | lower }}
          </div>
        </div>
      </div>

      {{/* Content section */}}
      <div class="px-8 py-8">
        {{/* Description/Abstract */}}
        {{ with $description }}
        <div class="mb-6">
          <h2 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100 mb-2">{{ $abstract_label }}</h2>
          <p class="text-zinc-600 dark:text-zinc-400 leading-relaxed">{{ . }}</p>
        </div>
        {{ end }}

        {{/* Topics/Tags */}}
        {{ if $topics }}
        <div class="mb-6">
          <h2 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100 mb-2">{{ $topics_label }}</h2>
          <div class="flex flex-wrap gap-2">
            {{ range $topics }}
            <a href="{{ "/slides/" | relURL }}" class="px-3 py-1 rounded-full text-sm font-medium bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 hover:bg-primary-100 dark:hover:bg-primary-900/40 hover:text-primary-700 dark:hover:text-primary-300 transition-colors">
              {{ . }}
            </a>
            {{ end }}
          </div>
        </div>
        {{ end }}

        {{/* Related Resources - Use HugoBlox standard links */}}
        {{ if $resourceLinks }}
        <div class="mb-6">
          <h2 class="text-lg font-semibold text-zinc-900 dark:text-zinc-100 mb-2">{{ $related_resources_label }}</h2>
          <div class="flex flex-wrap gap-3">
            {{ range $resourceLinks }}
              {{ $linkLabel := .label }}
              {{ with .labelKey }}
                {{ $linkLabel = i18n . | default $linkLabel }}
              {{ end }}
              {{ $target := "" }}
              {{ $rel := "" }}
              {{ $scheme := (urls.Parse .url).Scheme }}
              {{ if in (slice "http" "https") $scheme }}
                {{ $target = "_blank" }}
                {{ $rel = "noopener" }}
              {{ end }}
              
              <a href="{{ .url }}" {{ with $target }}target="{{ . }}"{{ end }} {{ with $rel }}rel="{{ . }}"{{ end }} class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors">
                {{ partial "functions/get_icon" (dict "name" (.icon | default "hero/link") "attributes" "class='w-4 h-4'") }}
                {{ $linkLabel }}
              </a>
            {{ end }}
          </div>
        </div>
        {{ end }}

        {{/* Share Panel */}}
        <div class="flex flex-wrap gap-3 pt-6 border-t border-zinc-100 dark:border-zinc-800 mb-6">
          {{/* Open Presenter */}}
          {{ with $present_format }}
          <a href="{{ .RelPermalink }}" target="_blank" rel="noopener" class="inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-primary-600 hover:bg-primary-700 text-white font-semibold transition-colors shadow-lg shadow-primary-500/25 cursor-pointer">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"/>
            </svg>
            {{ $present_fullscreen_label }}
          </a>
          {{ end }}

          {{/* Copy Link */}}
          <button 
            @click="navigator.clipboard.writeText('{{ .Permalink }}'); copied = true; copyText = {{ $copied_label | jsonify }}; setTimeout(() => { copied = false; copyText = {{ $copy_link_label | jsonify }}; }, 2000)"
            class="inline-flex items-center gap-2 px-4 py-3 rounded-lg bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" x-show="!copied">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" x-show="copied" x-cloak>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span x-text="copyText">{{ $copy_link_label }}</span>
          </button>

          {{/* Copy Citation */}}
          {{ if $has_citation_copy }}
          <button 
            @click="navigator.clipboard.writeText(citationValue); citationCopied = true; citationCopyText = {{ $copied_label | jsonify }}; setTimeout(() => { citationCopied = false; citationCopyText = {{ $copy_citation_label | jsonify }}; }, 2000)"
            class="inline-flex items-center gap-2 px-4 py-3 rounded-lg bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" x-show="!citationCopied">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" x-show="citationCopied" x-cloak>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span x-text="citationCopyText">{{ $copy_citation_label }}</span>
          </button>
          {{ end }}

          {{/* Print PDF */}}
          {{ with $present_format }}
          <a href="{{ .RelPermalink }}?print-pdf" target="_blank" rel="noopener" class="inline-flex items-center gap-2 px-4 py-3 rounded-lg bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors" title="{{ $print_hint }}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            {{ $export_pdf_label }}
          </a>
          {{ end }}
        </div>

        {{/* Citation Section - Use HugoBlox standard links + citation field */}}
        {{ if or $citation $citationLinks }}
        <div class="pt-6 border-t border-zinc-100 dark:border-zinc-800">
          <button 
            @click="showCitation = !showCitation"
            class="flex items-center gap-2 text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors"
          >
            <svg class="w-4 h-4 transition-transform" :class="showCitation && 'rotate-90'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
            {{ $how_to_cite_label }}
          </button>
          <div x-show="showCitation" x-transition class="mt-3 space-y-3">
            {{ with $citation }}
            <div>
              <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 mb-1">{{ $citation_label }}</h4>
              <pre class="p-4 bg-zinc-50 dark:bg-zinc-800/50 rounded-lg text-sm text-zinc-700 dark:text-zinc-300 overflow-x-auto"><code>{{ . }}</code></pre>
            </div>
            {{ end }}
            
            {{/* DOI and BibTeX from standard links structure */}}
            {{ range $citationLinks }}
              {{ if eq .type "doi" }}
              <div>
                <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 mb-1">{{ $doi_label }}</h4>
                <a href="{{ .url }}" target="_blank" rel="noopener" class="text-sm text-primary-600 dark:text-primary-400 hover:underline">
                  {{ .url | replaceRE "^https://doi.org/" "" }}
                </a>
              </div>
              {{ else if eq .type "bibtex" }}
              <div>
                <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 mb-1">{{ $bibtex_label }}</h4>
                <a href="{{ .url }}" class="text-sm text-primary-600 dark:text-primary-400 hover:underline">
                  {{ $download_cite_bib_label }}
                </a>
              </div>
              {{ end }}
            {{ end }}
          </div>
        </div>
        {{ end }}

      </div>
    </div>

  </div>

</div>

{{ end }}
