<footer class="container mx-auto flex flex-col justify-items-center text-sm leading-6 mt-24 mb-4 text-slate-700 dark:text-slate-200">

  {{ partial "functions/get_hook" (dict "hook" "footer-start" "context" .) }}

  {{/* Load footer block */}}
  {{- $footer_config := site.Params.footer | default dict -}}
  {{- $footer_section_name := partial "hbx/resolve-block-param" (dict "config" $footer_config "context" "footer") | default "minimal" -}}
  {{ $footer_section_path := printf "components/footers/%s.html" $footer_section_name }}
  {{ if not (templates.Exists (printf "_partials/%s" $footer_section_path)) }}
    {{ errorf "Check your `params.yaml`. Cannot find footer block at `layouts/_partials/%s`" $footer_section_path }}
  {{ end }}
  {{ partial $footer_section_path . }}

  {{/* Attribution - PLEASE DO NOT REMOVE THIS, SUPPORT OPEN SOURCE */}}
  {{- if not (site.Params.i_am_a_sponsor | default false) -}}
    {{- $base := "https://hugoblox.com" -}}
    {{- $tid  := "" -}}
    {{- $ref  := .Site.Params.affiliate_ref | default "" -}}
  
    {{/* Detect Template */}}
    {{ $hugoblox_file := "" }}
    {{ if fileExists "hugoblox.yaml" }}
      {{ $hugoblox_file = readFile "hugoblox.yaml" }}
      {{ if $hugoblox_file }}
        {{ $hugoblox_data := $hugoblox_file | transform.Unmarshal }}
        {{ $tid = $hugoblox_data.template.id | default "" }}
      {{ end }}
    {{ end }}

    {{/* Per-site variant selection */}}
    {{- $brandOptions := slice "Hugo Blox" "Hugo Blox Builder" "Hugo Blox — Open Source" -}}
    {{- $ctaWhenTemplate := slice "Duplicate this template →" "Clone this template →" "Build yours →" "Create yours →" "Build your site →" "Create your site →" -}}
    {{- $ctaNoTemplate   := slice "Start free →" "Build yours →" "Create yours →" "Build your site →" "Create your site →" -}}
  
    {{- $seed := .Site.BaseURL -}}
    {{- $h := md5 $seed -}}
    {{- $digits := replaceRE "[^0-9]" "" $h -}}
    {{- if lt (len $digits) 6 }}{{- $digits = printf "%s123456" $digits -}}{{- end -}}
    {{- $n := int (strings.TrimPrefix (substr $digits 0 6) "0") -}}

    {{- $brandText := index $brandOptions (mod $n (len $brandOptions)) -}}
    {{- $ctaText   := cond (ne $tid "")
          (index $ctaWhenTemplate (mod $n (len $ctaWhenTemplate)))
          (index $ctaNoTemplate   (mod $n (len $ctaNoTemplate))) -}}
  
    {{- $target := cond (ne $tid "")
          (printf "%s/templates/%s/start" $base $tid)
          (printf "%s/start" $base) -}}
  
    {{- $brandHref := printf "%s?utm_source=site_footer&utm_medium=referral&utm_campaign=poweredby_oss&utm_content=brand_%s"
          $base (cond (ne $tid "") (printf "%s" $tid) "na") -}}
    {{- $ctaHref := printf "%s?utm_source=site_footer&utm_medium=referral&utm_campaign=poweredby_oss&utm_content=cta_%s"
          $target (cond (ne $tid "") (printf "%s" $tid) "na") -}}
    {{- if ne $ref "" -}}
      {{- $brandHref = printf "%s&ref=%s" $brandHref $ref -}}
      {{- $ctaHref   = printf "%s&ref=%s"   $ctaHref   $ref -}}
    {{- end -}}
  
    <p class="powered-by text-center text-sm opacity-80 py-1">
      {{ $published_with := "Made with {hugoblox}." }}
      {{ $i18n_published_with := i18n "published_with" | default $published_with }}
      {{ $defaultEnText := "Build yours →" }}
      {{ $i18n_ctaText := i18n "poweredby_button" | default $ctaText }}
      {{ if eq $i18n_ctaText $defaultEnText }}
        {{ $i18n_ctaText = $ctaText }}
      {{ end }}
      {{ if not (findRE "{hugoblox}" $i18n_published_with) }}
        {{ warnf "Please attribute Hugo Blox using `{hugoblox}` in the i18n `published_with` text or sponsor with All Access to remove attribution." }}
        {{ $i18n_published_with = $published_with }}
      {{ end }}
      {{ $i18n_published_with = replace $i18n_published_with "{hugoblox}" (printf "<a class=\"underline hover:opacity-100\" href=\"%s\" target=\"_blank\" rel=\"noopener\" data-hbx=\"poweredby_brand\">%s</a>" $brandHref $brandText) | safeHTML }}
      {{ $i18n_published_with = replace $i18n_published_with "{repo_link}" "<a href=\"https://github.com/HugoBlox/hugo-blox-builder\" target=\"_blank\" rel=\"noopener\">" | safeHTML }}
      {{ $i18n_published_with = replace $i18n_published_with "{/repo_link}" "</a>" | safeHTML }}
      {{ $i18n_published_with | safeHTML }}
      <a class="inline-flex items-center rounded px-2 py-0.5 border border-current ms-2 text-xs hover:opacity-100"
         href="{{ $ctaHref }}" target="_blank" rel="noopener" data-hbx="poweredby_cta">{{ $i18n_ctaText }}</a>
    </p>
  {{- end -}}  

</footer>
